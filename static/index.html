<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Stables - Live Stats</title>
    <meta name="description" content="Live NBA statistics, scores, and player tracking">
    <meta name="theme-color" content="#ff6b35">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/static/manifest.json">
    <link rel="apple-touch-icon" href="/static/icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a24;
            --bg-hover: #22222e;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --accent: #ff6b35;
            --accent-light: #ff8c5a;
            --success: #4ade80;
            --border: #2a2a3a;
            --gradient-1: linear-gradient(135deg, #ff6b35 0%, #ff8c5a 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-date {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Navigation */
        nav {
            background: var(--bg-secondary);
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .nav-tab {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .nav-tab.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        /* Main Content */
        main {
            padding: 30px 0;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title .badge {
            background: var(--accent);
            color: white;
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 500;
        }

        /* Cards */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        /* Game Card */
        .game-card {
            padding: 20px;
        }

        .game-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .game-status.live {
            background: #ef4444;
            color: white;
            animation: pulse 2s infinite;
        }

        .game-status.final {
            background: var(--bg-hover);
            color: var(--text-secondary);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .teams-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .team-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .team-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .team-tricode {
            font-size: 0.8rem;
            color: var(--text-secondary);
            background: var(--bg-hover);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .team-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .team-score {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--accent);
        }

        .leader-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .leader-title {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .leader-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .leader-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .leader-stats {
            display: flex;
            gap: 15px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-weight: 600;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        /* Box Score */
        .boxscore-card {
            overflow-x: auto;
        }

        .boxscore-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .boxscore-table th,
        .boxscore-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .boxscore-table th {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .boxscore-table td:first-child {
            text-align: left;
            font-weight: 600;
        }

        .boxscore-table tr:hover td {
            background: var(--bg-hover);
        }

        .highlight {
            color: var(--success);
            font-weight: 600;
        }

        /* Leaders Section */
        .leaders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .leader-card {
            padding: 20px;
        }

        .leader-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .leader-category {
            font-weight: 600;
            font-size: 1rem;
        }

        .leader-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        .leader-players {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .leader-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .leader-player-name {
            font-weight: 500;
        }

        .leader-player-team {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* Player Tracker */
        .player-search {
            margin-bottom: 30px;
        }

        .search-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .search-input-wrapper {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 15px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-top: 5px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 50;
            display: none;
        }

        .search-results.show {
            display: block;
        }

        .search-result-item {
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
        }

        .search-result-item:hover {
            background: var(--bg-hover);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .tracked-players {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .player-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: var(--bg-card);
            border: 1px solid var(--accent);
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .player-chip-remove {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            line-height: 1;
        }

        .player-chip-remove:hover {
            color: #ef4444;
        }

        .btn {
            padding: 15px 30px;
            background: var(--gradient-1);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .player-stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .player-stats-table th,
        .player-stats-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .player-stats-table th {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .player-stats-table td:first-child {
            text-align: left;
        }

        .player-stats-table tbody tr:hover {
            background: var(--bg-hover);
        }

        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 60px;
            color: var(--text-secondary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .empty-state-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        /* Refresh Button */
        .refresh-btn {
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .refresh-btn:hover {
            background: var(--bg-card);
        }

        /* Date Selector */
        .date-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }

        .date-btn {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.85rem;
        }

        .date-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .date-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: 10px;
            }

            .nav-tabs {
                justify-content: flex-start;
            }

            .search-container {
                flex-direction: column;
            }

            .search-input-wrapper {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">&#127936;</div>
                    <h1>NBA Stables</h1>
                </div>
                <div class="header-date" id="currentDate">Loading...</div>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <div class="nav-tabs">
                <button class="nav-tab active" data-section="scoreboard">Live Scoreboard</button>
                <button class="nav-tab" data-section="boxscores">Box Scores</button>
                <button class="nav-tab" data-section="leaders">Daily Leaders</button>
                <button class="nav-tab" data-section="tracker">Player Tracker</button>
                <button class="nav-tab" data-section="standings">Standings</button>
                <button class="nav-tab" data-section="injuries">Injuries</button>
                <button class="nav-tab" data-section="widgets">Widgets</button>
                <button class="nav-tab" data-section="download">Download App</button>
            </div>
        </div>
    </nav>

    <main>
        <div class="container">
            <!-- Scoreboard Section -->
            <section id="scoreboard" class="section active">
                <div class="section-title">
                    Live Scoreboard
                    <span class="badge" id="gamesCount">0 Games</span>
                    <button class="refresh-btn" onclick="loadScoreboard()">&#8635; Refresh</button>
                </div>
                <div id="scoreboardContent" class="cards-grid">
                    <div class="loading"><div class="spinner"></div> Loading games...</div>
                </div>
            </section>

            <!-- Box Scores Section -->
            <section id="boxscores" class="section">
                <div class="section-title">
                    Box Scores
                    <button class="refresh-btn" onclick="loadBoxscores()">&#8635; Refresh</button>
                </div>
                <div class="date-selector">
                    <button class="date-btn active" data-offset="0">Today</button>
                    <button class="date-btn" data-offset="1">Yesterday</button>
                    <button class="date-btn" data-offset="2">2 Days Ago</button>
                </div>
                <div id="boxscoresContent">
                    <div class="loading"><div class="spinner"></div> Loading box scores...</div>
                </div>
            </section>

            <!-- Leaders Section -->
            <section id="leaders" class="section">
                <div class="section-title">
                    Daily Leaders
                    <button class="refresh-btn" onclick="loadLeaders()">&#8635; Refresh</button>
                </div>
                <div class="date-selector" id="leadersDateSelector">
                    <button class="date-btn" data-offset="0">Today</button>
                    <button class="date-btn active" data-offset="1">Yesterday</button>
                    <button class="date-btn" data-offset="2">2 Days Ago</button>
                </div>
                <div id="leadersContent" class="leaders-grid">
                    <div class="loading"><div class="spinner"></div> Loading leaders...</div>
                </div>
            </section>

            <!-- Player Tracker Section -->
            <section id="tracker" class="section">
                <div class="section-title">Player Tracker</div>
                <div class="player-search">
                    <div class="search-container">
                        <div class="search-input-wrapper">
                            <input type="text" class="search-input" id="playerSearch" placeholder="Search for a player..." autocomplete="off">
                            <div class="search-results" id="searchResults"></div>
                        </div>
                        <button class="btn" id="trackBtn" onclick="loadTrackedStats()" disabled>Get Live Stats</button>
                    </div>
                    <div class="tracked-players" id="trackedPlayers"></div>
                </div>
                <div id="trackerContent">
                    <div class="empty-state">
                        <div class="empty-state-icon">&#127942;</div>
                        <div class="empty-state-title">Track Your Favorite Players</div>
                        <p>Search and select players above to see their live game stats</p>
                    </div>
                </div>
            </section>

            <!-- Standings Section -->
            <section id="standings" class="section">
                <div class="section-title">
                    NBA Standings
                    <button class="refresh-btn" onclick="loadStandings()">&#8635; Refresh</button>
                </div>
                <div id="standingsContent" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 20px;">
                    <div class="loading"><div class="spinner"></div> Loading standings...</div>
                </div>
            </section>

            <!-- Injuries Section -->
            <section id="injuries" class="section">
                <div class="section-title">
                    Injury Report
                    <span class="badge" id="injuriesSourceBadge" style="background: #ef4444;">CBS</span>
                    <button class="refresh-btn" onclick="loadInjuries()">&#8635; Refresh</button>
                </div>
                <div style="margin-bottom: 20px; display: flex; gap: 20px; flex-wrap: wrap;">
                    <div>
                        <button class="date-btn active" id="injuriesListBtn" onclick="setInjuriesView('list')">All Players</button>
                        <button class="date-btn" id="injuriesGroupBtn" onclick="setInjuriesView('grouped')">Group by Team</button>
                    </div>
                    <div>
                        <span style="color: var(--text-secondary); font-size: 0.8rem; margin-right: 8px;">Source:</span>
                        <button class="date-btn" id="injuriesEspnBtn" onclick="setInjuriesSource('espn')">ESPN</button>
                        <button class="date-btn active" id="injuriesCbsBtn" onclick="setInjuriesSource('cbs')">CBS</button>
                    </div>
                </div>
                <div id="injuriesContent">
                    <div class="loading"><div class="spinner"></div> Loading injury report...</div>
                </div>
            </section>

            <!-- Widgets Section -->
            <section id="widgets" class="section">
                <div class="section-title">Desktop Widgets</div>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Download widgets for your macOS desktop. Requires <a href="https://tracesof.net/uebersicht/" target="_blank" style="color: var(--accent);">Ubersicht</a> app.</p>

                <div class="widgets-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 30px;">
                    <!-- Scoreboard Widget -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="margin-bottom: 15px; color: var(--accent);">NBA Scoreboard Widget</h3>
                        <div class="widget-preview" style="background: #0a0a0f; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <div class="widget-mockup" style="background: rgba(10, 10, 15, 0.95); padding: 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); font-size: 13px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                    <span style="font-weight: 600;">&#127936; NBA Live</span>
                                    <span style="color: #888; font-size: 11px;">February 11, 2026</span>
                                </div>
                                <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; margin-bottom: 8px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                        <span style="font-size: 12px;">LAL</span>
                                        <span style="color: #ff6b35; font-weight: 700;">108</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="font-size: 12px;">BOS</span>
                                        <span style="color: #ff6b35; font-weight: 700;">112</span>
                                    </div>
                                    <div style="font-size: 10px; color: #888; margin-top: 6px;">Q4 2:30</div>
                                </div>
                            </div>
                        </div>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 20px;">
                            Shows live NBA scores on your desktop. Updates every 60 seconds. Displays team scores, game status, and top performers.
                        </p>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn" onclick="downloadWidget('scoreboard')">Download Widget</button>
                            <button class="btn" style="background: var(--bg-hover); border: 1px solid var(--border);" onclick="showWidgetCode('scoreboard')">View Code</button>
                        </div>
                    </div>

                    <!-- Player Tracker Widget -->
                    <div class="card" style="padding: 20px;">
                        <h3 style="margin-bottom: 15px; color: var(--accent);">Player Tracker Widget</h3>
                        <div class="widget-preview" style="background: #0a0a0f; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <div class="widget-mockup" style="background: rgba(10, 10, 15, 0.95); padding: 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); font-size: 13px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                    <span style="font-weight: 600;">&#127942; My Players</span>
                                </div>
                                <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; margin-bottom: 8px;">
                                    <div style="font-weight: 500; margin-bottom: 4px;">LeBron James</div>
                                    <div style="font-size: 11px; color: #888;">LAL | 32:15</div>
                                    <div style="display: flex; gap: 15px; margin-top: 6px; font-size: 12px;">
                                        <span><span style="color: #ff6b35;">28</span> PTS</span>
                                        <span><span style="color: #ff6b35;">8</span> REB</span>
                                        <span><span style="color: #ff6b35;">11</span> AST</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 20px;">
                            Track specific players live stats. Edit the widget to add your favorite player IDs. Shows points, rebounds, assists, and more.
                        </p>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn" onclick="downloadWidget('player')">Download Widget</button>
                            <button class="btn" style="background: var(--bg-hover); border: 1px solid var(--border);" onclick="showWidgetCode('player')">View Code</button>
                        </div>
                    </div>
                </div>

                <!-- Installation Instructions -->
                <div class="card" style="padding: 25px; margin-top: 30px;">
                    <h3 style="margin-bottom: 20px; color: var(--accent);">Installation Instructions</h3>
                    <ol style="color: var(--text-secondary); line-height: 2; padding-left: 20px;">
                        <li>Download and install <a href="https://tracesof.net/uebersicht/" target="_blank" style="color: var(--accent);">Ubersicht</a> for macOS</li>
                        <li>Download a widget file from above</li>
                        <li>Move the <code style="background: var(--bg-secondary); padding: 2px 8px; border-radius: 4px;">.jsx</code> file to <code style="background: var(--bg-secondary); padding: 2px 8px; border-radius: 4px;">~/Library/Application Support/Ubersicht/widgets/</code></li>
                        <li>The widget will automatically appear on your desktop</li>
                        <li><strong>Important:</strong> Edit the <code style="background: var(--bg-secondary); padding: 2px 8px; border-radius: 4px;">API_URL</code> in the widget file to point to your deployed API (or use localhost for local testing)</li>
                    </ol>
                </div>

                <!-- Widget Code Modal -->
                <div id="widgetCodeModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; padding: 50px;">
                    <div style="max-width: 800px; margin: 0 auto; background: var(--bg-card); border-radius: 12px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
                        <div style="padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
                            <h3>Widget Code</h3>
                            <button onclick="closeWidgetModal()" style="background: none; border: none; color: var(--text-primary); font-size: 24px; cursor: pointer;">&times;</button>
                        </div>
                        <pre id="widgetCodeContent" style="padding: 20px; overflow: auto; flex: 1; background: var(--bg-secondary); margin: 0; font-size: 12px; line-height: 1.5;"></pre>
                    </div>
                </div>
            </section>

            <!-- Download Section -->
            <section id="download" class="section">
                <div class="section-title">Download Android Widget</div>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Get live NBA scores directly on your Android home screen.</p>

                <div class="card" style="padding: 30px; max-width: 500px;">
                    <div style="text-align: center; margin-bottom: 25px;">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #ff6b35, #ff8c5a); border-radius: 20px; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 40px;">&#127936;</div>
                        <h2 style="margin-bottom: 5px;">NBA Stables Widget</h2>
                        <p style="color: var(--text-secondary);">v1.0 • Android 8.0+</p>
                    </div>

                    <ul style="color: var(--text-secondary); margin-bottom: 25px; padding-left: 20px; line-height: 2;">
                        <li>Live NBA scores on your home screen</li>
                        <li>Auto-updates every 15 minutes</li>
                        <li>Dark theme, minimal design</li>
                        <li>No ads, no tracking</li>
                    </ul>

                    <a href="https://github.com/sreckoskocilic/nba_stables/releases/latest/download/app-release.apk"
                       class="btn"
                       style="display: block; text-align: center; text-decoration: none; margin-bottom: 15px;">
                        Download APK
                    </a>

                    <p style="color: var(--text-secondary); font-size: 0.8rem; text-align: center;">
                        Or view all releases on <a href="https://github.com/sreckoskocilic/nba_stables/releases" target="_blank" style="color: var(--accent);">GitHub</a>
                    </p>
                </div>

                <div class="card" style="padding: 25px; margin-top: 20px; max-width: 500px;">
                    <h3 style="margin-bottom: 15px; color: var(--accent);">Installation</h3>
                    <ol style="color: var(--text-secondary); line-height: 2; padding-left: 20px;">
                        <li>Download the APK file</li>
                        <li>Open on your Android phone</li>
                        <li>Allow "Install from unknown sources" if prompted</li>
                        <li>Install the app</li>
                        <li>Long-press home screen → Widgets → NBA Stables</li>
                    </ol>
                </div>
            </section>
        </div>
    </main>

    <script>
        const API_BASE = '';
        let trackedPlayerIds = [];
        let currentBoxscoreOffset = 0;
        let currentLeadersOffset = 1;

        // Navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));

                tab.classList.add('active');
                document.getElementById(tab.dataset.section).classList.add('active');

                // Load data when switching tabs
                switch(tab.dataset.section) {
                    case 'scoreboard': loadScoreboard(); break;
                    case 'boxscores': loadBoxscores(); break;
                    case 'leaders': loadLeaders(); break;
                    case 'standings': loadStandings(); break;
                    case 'injuries': loadInjuries(); break;
                }
            });
        });

        // Date selectors
        document.querySelectorAll('#boxscores .date-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('#boxscores .date-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentBoxscoreOffset = parseInt(btn.dataset.offset);
                loadBoxscores();
            });
        });

        document.querySelectorAll('#leadersDateSelector .date-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('#leadersDateSelector .date-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentLeadersOffset = parseInt(btn.dataset.offset);
                loadLeaders();
            });
        });

        // Load Scoreboard
        async function loadScoreboard() {
            const container = document.getElementById('scoreboardContent');
            container.innerHTML = '<div class="loading"><div class="spinner"></div> Loading games...</div>';

            try {
                const res = await fetch(`${API_BASE}/api/scoreboard`);
                const data = await res.json();

                document.getElementById('currentDate').textContent = data.date;
                document.getElementById('gamesCount').textContent = `${data.games.length} Games`;

                if (data.games.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">&#127944;</div>
                            <div class="empty-state-title">No Games Today</div>
                            <p>Check back later for live games</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = data.games.map(game => `
                    <div class="card game-card">
                        <span class="game-status ${game.status.toLowerCase().includes('final') ? 'final' : 'live'}">${game.status}</span>
                        <div class="teams-container">
                            <div class="team-row">
                                <div class="team-info">
                                    <span class="team-tricode">${game.homeTeam.tricode}</span>
                                    <span class="team-name">${game.homeTeam.name}</span>
                                </div>
                                <span class="team-score">${game.homeTeam.score}</span>
                            </div>
                            <div class="team-row">
                                <div class="team-info">
                                    <span class="team-tricode">${game.awayTeam.tricode}</span>
                                    <span class="team-name">${game.awayTeam.name}</span>
                                </div>
                                <span class="team-score">${game.awayTeam.score}</span>
                            </div>
                        </div>
                        <div class="leader-section">
                            <div class="leader-title">Top Performers</div>
                            <div class="leader-row">
                                <span class="leader-name">${game.homeTeam.leader.name}</span>
                                <div class="leader-stats">
                                    <div class="stat"><div class="stat-value">${game.homeTeam.leader.points}</div><div class="stat-label">PTS</div></div>
                                    <div class="stat"><div class="stat-value">${game.homeTeam.leader.rebounds}</div><div class="stat-label">REB</div></div>
                                    <div class="stat"><div class="stat-value">${game.homeTeam.leader.assists}</div><div class="stat-label">AST</div></div>
                                </div>
                            </div>
                            <div class="leader-row">
                                <span class="leader-name">${game.awayTeam.leader.name}</span>
                                <div class="leader-stats">
                                    <div class="stat"><div class="stat-value">${game.awayTeam.leader.points}</div><div class="stat-label">PTS</div></div>
                                    <div class="stat"><div class="stat-value">${game.awayTeam.leader.rebounds}</div><div class="stat-label">REB</div></div>
                                    <div class="stat"><div class="stat-value">${game.awayTeam.leader.assists}</div><div class="stat-label">AST</div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">&#9888;</div>
                        <div class="empty-state-title">Error Loading Games</div>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Load Box Scores
        async function loadBoxscores() {
            const container = document.getElementById('boxscoresContent');
            container.innerHTML = '<div class="loading"><div class="spinner"></div> Loading box scores...</div>';

            try {
                const res = await fetch(`${API_BASE}/api/boxscores?days_offset=${currentBoxscoreOffset}`);
                const data = await res.json();

                if (data.boxscores.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">&#128202;</div>
                            <div class="empty-state-title">No Box Scores Available</div>
                            <p>No completed games for ${data.date}</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = data.boxscores.map(game => `
                    <div class="card boxscore-card" style="margin-bottom: 20px; cursor: pointer;" onclick="toggleGameDetails('${game.gameId}', this)">
                        <table class="boxscore-table">
                            <thead>
                                <tr>
                                    <th>Team</th>
                                    <th>Score</th>
                                    <th>FG</th>
                                    <th>FG%</th>
                                    <th>3PT</th>
                                    <th>3P%</th>
                                    <th>FT</th>
                                    <th>FT%</th>
                                    <th>REB</th>
                                    <th>AST</th>
                                    <th>STL</th>
                                    <th>BLK</th>
                                    <th>TO</th>
                                    <th>Leader</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${game.teams.map(team => `
                                    <tr>
                                        <td>${team.name}</td>
                                        <td class="highlight">${team.score}</td>
                                        <td>${team.stats.fg}</td>
                                        <td>${(team.stats.fgPct * 100).toFixed(1)}%</td>
                                        <td>${team.stats.threePt}</td>
                                        <td>${(team.stats.threePtPct * 100).toFixed(1)}%</td>
                                        <td>${team.stats.ft}</td>
                                        <td>${(team.stats.ftPct * 100).toFixed(1)}%</td>
                                        <td>${team.stats.rebounds}</td>
                                        <td>${team.stats.assists}</td>
                                        <td>${team.stats.steals}</td>
                                        <td>${team.stats.blocks}</td>
                                        <td>${team.stats.turnovers}</td>
                                        <td>${team.leader.name} (${team.leader.points}/${team.leader.rebounds}/${team.leader.assists})</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <div style="text-align: center; padding: 8px; color: var(--text-secondary); font-size: 0.8rem;">
                            Click to see player details ▼
                        </div>
                        <div class="game-details" id="details-${game.gameId}" style="display: none;"></div>
                    </div>
                `).join('');
            } catch (error) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">&#9888;</div>
                        <div class="empty-state-title">Error Loading Box Scores</div>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Load Leaders
        async function loadLeaders() {
            const container = document.getElementById('leadersContent');
            container.innerHTML = '<div class="loading"><div class="spinner"></div> Loading leaders...</div>';

            try {
                const res = await fetch(`${API_BASE}/api/leaders?days_offset=${currentLeadersOffset}`);
                const data = await res.json();

                const categories = Object.values(data.leaders);

                if (categories.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">&#127942;</div>
                            <div class="empty-state-title">No Stats Available</div>
                            <p>No completed games for ${data.date}</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = categories.map(cat => `
                    <div class="card leader-card">
                        <div class="leader-card-header">
                            <span class="leader-category">${cat.label}</span>
                            <span class="leader-value">${cat.value}</span>
                        </div>
                        <div class="leader-players">
                            ${cat.players.map(p => `
                                <div class="leader-player">
                                    <span class="leader-player-name">${p.name}</span>
                                    <span class="leader-player-team">${p.team}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">&#9888;</div>
                        <div class="empty-state-title">Error Loading Leaders</div>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Player Search
        const searchInput = document.getElementById('playerSearch');
        const searchResults = document.getElementById('searchResults');
        let searchTimeout;

        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            const query = searchInput.value.trim();

            if (query.length < 2) {
                searchResults.classList.remove('show');
                return;
            }

            searchTimeout = setTimeout(async () => {
                try {
                    const res = await fetch(`${API_BASE}/api/players/search?q=${encodeURIComponent(query)}`);
                    const data = await res.json();

                    if (data.players.length === 0) {
                        searchResults.innerHTML = '<div class="search-result-item">No players found</div>';
                    } else {
                        searchResults.innerHTML = data.players.map(p => `
                            <div class="search-result-item" data-id="${p.id}" data-name="${p.name}">
                                <span>${p.name}</span>
                                <span style="color: var(--text-secondary); font-size: 0.85rem;">ID: ${p.id}</span>
                            </div>
                        `).join('');
                    }
                    searchResults.classList.add('show');
                } catch (error) {
                    searchResults.innerHTML = '<div class="search-result-item">Error searching</div>';
                    searchResults.classList.add('show');
                }
            }, 300);
        });

        searchResults.addEventListener('click', (e) => {
            const item = e.target.closest('.search-result-item');
            if (item && item.dataset.id) {
                addTrackedPlayer(parseInt(item.dataset.id), item.dataset.name);
                searchInput.value = '';
                searchResults.classList.remove('show');
            }
        });

        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                searchResults.classList.remove('show');
            }
        });

        function addTrackedPlayer(id, name) {
            if (trackedPlayerIds.find(p => p.id === id)) return;

            trackedPlayerIds.push({ id, name });
            updateTrackedPlayersUI();
        }

        function removeTrackedPlayer(id) {
            trackedPlayerIds = trackedPlayerIds.filter(p => p.id !== id);
            updateTrackedPlayersUI();
        }

        function updateTrackedPlayersUI() {
            const container = document.getElementById('trackedPlayers');
            const trackBtn = document.getElementById('trackBtn');

            container.innerHTML = trackedPlayerIds.map(p => `
                <div class="player-chip">
                    <span>${p.name}</span>
                    <button class="player-chip-remove" onclick="removeTrackedPlayer(${p.id})">&times;</button>
                </div>
            `).join('');

            trackBtn.disabled = trackedPlayerIds.length === 0;
        }

        async function loadTrackedStats() {
            if (trackedPlayerIds.length === 0) return;

            const container = document.getElementById('trackerContent');
            container.innerHTML = '<div class="loading"><div class="spinner"></div> Loading player stats...</div>';

            try {
                const ids = trackedPlayerIds.map(p => p.id).join(',');
                const res = await fetch(`${API_BASE}/api/players/stats?ids=${ids}`);
                const data = await res.json();

                if (data.players.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">&#128564;</div>
                            <div class="empty-state-title">No Active Games</div>
                            <p>Selected players don't have games in progress today</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `
                    <div class="card" style="overflow-x: auto;">
                        <table class="player-stats-table">
                            <thead>
                                <tr>
                                    <th>Player</th>
                                    <th>Team</th>
                                    <th>MIN</th>
                                    <th>PTS</th>
                                    <th>3PT</th>
                                    <th>REB</th>
                                    <th>AST</th>
                                    <th>BLK</th>
                                    <th>STL</th>
                                    <th>TO</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.players.map(p => `
                                    <tr>
                                        <td><strong>${p.name}</strong></td>
                                        <td>${p.team}</td>
                                        <td>${p.minutes}</td>
                                        <td class="${p.points > 0 ? 'highlight' : ''}">${p.points}</td>
                                        <td>${p.threePointers}</td>
                                        <td class="${p.rebounds > 0 ? 'highlight' : ''}">${p.rebounds}</td>
                                        <td class="${p.assists > 0 ? 'highlight' : ''}">${p.assists}</td>
                                        <td>${p.blocks}</td>
                                        <td>${p.steals}</td>
                                        <td>${p.turnovers}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">&#9888;</div>
                        <div class="empty-state-title">Error Loading Stats</div>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Toggle Game Details (Player Stats)
        async function toggleGameDetails(gameId, cardElement) {
            const detailsDiv = document.getElementById(`details-${gameId}`);

            if (detailsDiv.style.display === 'block') {
                detailsDiv.style.display = 'none';
                return;
            }

            detailsDiv.innerHTML = '<div class="loading" style="padding: 20px;"><div class="spinner"></div> Loading player stats...</div>';
            detailsDiv.style.display = 'block';

            try {
                const res = await fetch(`${API_BASE}/api/games/${gameId}/players`);
                const data = await res.json();

                detailsDiv.innerHTML = data.teams.map(team => `
                    <div style="padding: 15px; border-top: 1px solid var(--border);">
                        <h4 style="margin-bottom: 10px; color: var(--accent);">${team.name} - ${team.score}</h4>
                        <table class="boxscore-table" style="font-size: 0.8rem;">
                            <thead>
                                <tr>
                                    <th style="text-align: left;">Player</th>
                                    <th>MIN</th>
                                    <th>PTS</th>
                                    <th>REB</th>
                                    <th>AST</th>
                                    <th>FG</th>
                                    <th>3PT</th>
                                    <th>FT</th>
                                    <th>STL</th>
                                    <th>BLK</th>
                                    <th>TO</th>
                                    <th>+/-</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${team.players.map(p => `
                                    <tr>
                                        <td style="text-align: left;">${p.name}</td>
                                        <td>${p.minutes}</td>
                                        <td class="${p.points >= 20 ? 'highlight' : ''}">${p.points}</td>
                                        <td class="${p.rebounds >= 10 ? 'highlight' : ''}">${p.rebounds}</td>
                                        <td class="${p.assists >= 10 ? 'highlight' : ''}">${p.assists}</td>
                                        <td>${p.fg}</td>
                                        <td>${p.threePt}</td>
                                        <td>${p.ft}</td>
                                        <td>${p.steals}</td>
                                        <td>${p.blocks}</td>
                                        <td>${p.turnovers}</td>
                                        <td style="color: ${p.plusMinus > 0 ? 'var(--success)' : p.plusMinus < 0 ? '#ef4444' : 'inherit'};">${p.plusMinus > 0 ? '+' : ''}${p.plusMinus}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `).join('');
            } catch (error) {
                detailsDiv.innerHTML = `<div style="padding: 20px; color: var(--text-secondary);">Error loading player stats: ${error.message}</div>`;
            }
        }

        // Load Standings
        async function loadStandings() {
            const container = document.getElementById('standingsContent');
            container.innerHTML = '<div class="loading"><div class="spinner"></div> Loading standings...</div>';

            try {
                const res = await fetch(`${API_BASE}/api/standings`);
                const data = await res.json();

                const renderConference = (teams, name) => `
                    <div class="card" style="overflow-x: auto;">
                        <h3 style="padding: 15px 20px; background: var(--bg-secondary); margin: 0;">${name} Conference</h3>
                        <table class="boxscore-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th style="text-align: left;">Team</th>
                                    <th>W</th>
                                    <th>L</th>
                                    <th>PCT</th>
                                    <th>GB</th>
                                    <th>Streak</th>
                                    <th>L10</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${teams.map((team, i) => `
                                    <tr style="${i < 6 ? 'background: rgba(74, 222, 128, 0.05);' : i < 10 ? 'background: rgba(255, 107, 53, 0.05);' : ''}">
                                        <td style="text-align: center; font-weight: 600;">${team.rank}</td>
                                        <td style="text-align: left; font-weight: 500;">${team.name}</td>
                                        <td class="highlight">${team.wins}</td>
                                        <td>${team.losses}</td>
                                        <td>${(team.winPct * 100).toFixed(1)}%</td>
                                        <td>${team.gamesBack}</td>
                                        <td>${team.streak}</td>
                                        <td>${team.last10}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;

                container.innerHTML = renderConference(data.east, 'Eastern') + renderConference(data.west, 'Western');
            } catch (error) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">&#9888;</div>
                        <div class="empty-state-title">Error Loading Standings</div>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Load Injuries
        let injuriesData = null;
        let injuriesView = 'list';
        let injuriesSource = 'cbs';

        function setInjuriesView(view) {
            injuriesView = view;
            document.getElementById('injuriesListBtn').classList.toggle('active', view === 'list');
            document.getElementById('injuriesGroupBtn').classList.toggle('active', view === 'grouped');
            if (injuriesData) {
                renderInjuries();
            }
        }

        function setInjuriesSource(source) {
            injuriesSource = source;
            document.getElementById('injuriesEspnBtn').classList.toggle('active', source === 'espn');
            document.getElementById('injuriesCbsBtn').classList.toggle('active', source === 'cbs');
            document.getElementById('injuriesSourceBadge').textContent = source.toUpperCase();
            injuriesData = null; // Clear cache to fetch new source
            loadInjuries();
        }

        function renderInjuries() {
            const container = document.getElementById('injuriesContent');
            const data = injuriesData;

            if (injuriesView === 'list') {
                // Flat list of all players - compact 2-column newspaper style
                const allPlayers = [];
                data.injuries.forEach(team => {
                    team.players.forEach(p => {
                        allPlayers.push({ ...p, team: team.team });
                    });
                });

                // Split into 4 columns (newspaper style)
                const quarter = Math.ceil(allPlayers.length / 4);
                const cols = [
                    allPlayers.slice(0, quarter),
                    allPlayers.slice(quarter, quarter * 2),
                    allPlayers.slice(quarter * 2, quarter * 3),
                    allPlayers.slice(quarter * 3)
                ];

                const renderPlayer = (p) => {
                    const statusColor = p.status.toLowerCase().includes('out for') ? '#ef4444' :
                                       p.status.toLowerCase().includes('expected') ? '#f59e0b' : '#4ade80';
                    const shortStatus = p.status.includes('Out for') ? 'OUT' :
                                       p.status.includes('Expected') ? p.status.match(/Feb \d+|Mar \d+|Apr \d+/)?.[0] || 'DTD' : 'GTD';
                    const shortTeam = p.team.split(' ').pop().substring(0, 3).toUpperCase();
                    return `<div style="display: flex; justify-content: space-between; padding: 3px 6px; border-bottom: 1px solid var(--border); font-size: 10px;">
                        <span style="flex: 1; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${p.name}</span>
                        <span style="width: 28px; color: var(--text-secondary); text-align: center;">${shortTeam}</span>
                        <span style="width: 38px; text-align: right; color: ${statusColor}; font-weight: 600;">${shortStatus}</span>
                    </div>`;
                };

                const renderColumn = (players) => `
                    <div class="card" style="padding: 0; overflow: hidden;">
                        <div style="padding: 4px 6px; background: var(--bg-secondary); font-size: 9px; color: var(--text-secondary); display: flex; justify-content: space-between;">
                            <span style="flex: 1;">Player</span>
                            <span style="width: 28px; text-align: center;">Team</span>
                            <span style="width: 38px; text-align: right;">Status</span>
                        </div>
                        ${players.map(renderPlayer).join('')}
                    </div>
                `;

                container.innerHTML = `
                    <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 0.75rem;">
                        ${allPlayers.length} injured | GTD=Game Time Decision | OUT=Season | Date=Return
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                        ${cols.map(renderColumn).join('')}
                    </div>
                `;
            } else {
                // Grouped by team
                container.innerHTML = `
                    <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 0.9rem;">
                        Last updated: ${data.lastUpdated} | Source: ${data.source}
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(450px, 1fr)); gap: 20px;">
                        ${data.injuries.map(team => `
                            <div class="card" style="overflow: hidden;">
                                <div style="padding: 15px 20px; background: var(--bg-secondary); font-weight: 600; border-bottom: 1px solid var(--border);">
                                    ${team.team}
                                    <span style="color: var(--text-secondary); font-weight: normal; font-size: 0.85rem; margin-left: 10px;">${team.players.length} player${team.players.length !== 1 ? 's' : ''}</span>
                                </div>
                                <table class="boxscore-table" style="font-size: 0.85rem;">
                                    <thead>
                                        <tr>
                                            <th style="text-align: left;">Player</th>
                                            <th>Updated</th>
                                            <th>Injury</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${team.players.map(p => `
                                            <tr>
                                                <td style="text-align: left; font-weight: 500;">${p.name}</td>
                                                <td style="color: var(--text-secondary); font-size: 0.8rem;">${p.updated}</td>
                                                <td>${p.injury}</td>
                                                <td style="color: ${p.status.toLowerCase().includes('out') ? '#ef4444' : p.status.toLowerCase().includes('day-to-day') ? '#f59e0b' : 'var(--success)'}; font-weight: 500;">${p.status}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        async function loadInjuries() {
            const container = document.getElementById('injuriesContent');
            container.innerHTML = '<div class="loading"><div class="spinner"></div> Loading injury report...</div>';

            try {
                let res = await fetch(`${API_BASE}/api/injuries?source=${injuriesSource}`);
                let data = await res.json();

                // If CBS failed (rate limited), auto-switch to ESPN
                if (!res.ok && injuriesSource === 'cbs') {
                    console.log('CBS rate limited, switching to ESPN...');
                    injuriesSource = 'espn';
                    document.getElementById('injuriesEspnBtn').classList.add('active');
                    document.getElementById('injuriesCbsBtn').classList.remove('active');
                    document.getElementById('injuriesSourceBadge').textContent = 'ESPN';
                    res = await fetch(`${API_BASE}/api/injuries?source=espn`);
                    data = await res.json();
                }

                if (!res.ok) {
                    throw new Error(data.detail || 'Failed to load injuries');
                }

                if (!data.injuries || data.injuries.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">&#128170;</div>
                            <div class="empty-state-title">No Injuries Reported</div>
                            <p>All players are healthy!</p>
                        </div>
                    `;
                    return;
                }

                injuriesData = data;
                renderInjuries();
            } catch (error) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">&#9888;</div>
                        <div class="empty-state-title">Error Loading Injuries</div>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Widget Code Templates
        const widgetTemplates = {
            scoreboard: `// NBA Scoreboard Widget for Ubersicht
// Change the URL below to your deployed API URL
const API_URL = "${window.location.origin}";

export const refreshFrequency = 60000; // Refresh every 60 seconds

export const command = \`curl -s \${API_URL}/api/scoreboard\`;

export const className = \`
  top: 20px;
  right: 20px;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 13px;
  color: #fff;
  background: rgba(10, 10, 15, 0.85);
  backdrop-filter: blur(10px);
  padding: 16px;
  border-radius: 12px;
  width: 280px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  border: 1px solid rgba(255,255,255,0.1);
\`;

const headerStyle = {
  display: 'flex',
  justifyContent: 'space-between',
  alignItems: 'center',
  marginBottom: '12px',
  paddingBottom: '10px',
  borderBottom: '1px solid rgba(255,255,255,0.1)'
};

const titleStyle = { fontWeight: '600', fontSize: '14px', display: 'flex', alignItems: 'center', gap: '6px' };
const dateStyle = { fontSize: '11px', color: '#888' };
const gameStyle = { marginBottom: '10px', padding: '10px', background: 'rgba(255,255,255,0.05)', borderRadius: '8px' };
const teamRowStyle = { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '4px' };
const teamNameStyle = { fontSize: '12px', fontWeight: '500' };
const scoreStyle = { fontSize: '14px', fontWeight: '700', color: '#ff6b35' };
const statusStyle = { fontSize: '10px', color: '#888', textTransform: 'uppercase', marginTop: '6px' };
const leaderStyle = { fontSize: '10px', color: '#666', marginTop: '4px' };
const emptyStyle = { textAlign: 'center', padding: '20px', color: '#666' };

export const render = ({ output }) => {
  try {
    const data = JSON.parse(output);
    if (!data.games || data.games.length === 0) {
      return (
        <div>
          <div style={headerStyle}><span style={titleStyle}>🏀 NBA Stables</span></div>
          <div style={emptyStyle}>No games today</div>
        </div>
      );
    }
    return (
      <div>
        <div style={headerStyle}>
          <span style={titleStyle}>🏀 NBA Live</span>
          <span style={dateStyle}>{data.date}</span>
        </div>
        {data.games.map((game, i) => (
          <div key={i} style={gameStyle}>
            <div style={teamRowStyle}>
              <span style={teamNameStyle}>{game.awayTeam.tricode}</span>
              <span style={scoreStyle}>{game.awayTeam.score}</span>
            </div>
            <div style={teamRowStyle}>
              <span style={teamNameStyle}>{game.homeTeam.tricode}</span>
              <span style={scoreStyle}>{game.homeTeam.score}</span>
            </div>
            <div style={statusStyle}>{game.status}</div>
            <div style={leaderStyle}>⭐ {game.homeTeam.leader.name} {game.homeTeam.leader.points}pts</div>
          </div>
        ))}
      </div>
    );
  } catch (e) {
    return (
      <div>
        <div style={headerStyle}><span style={titleStyle}>🏀 NBA Stables</span></div>
        <div style={emptyStyle}>Loading...</div>
      </div>
    );
  }
};`,

            player: `// NBA Player Tracker Widget for Ubersicht
// Change the URL and PLAYER_IDS below
const API_URL = "${window.location.origin}";
const PLAYER_IDS = "203507,201566,1629029"; // LeBron, Harden, Luka - change to your players

export const refreshFrequency = 30000; // Refresh every 30 seconds

export const command = \`curl -s "\${API_URL}/api/players/stats?ids=\${PLAYER_IDS}"\`;

export const className = \`
  top: 20px;
  left: 20px;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 13px;
  color: #fff;
  background: rgba(10, 10, 15, 0.85);
  backdrop-filter: blur(10px);
  padding: 16px;
  border-radius: 12px;
  width: 300px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  border: 1px solid rgba(255,255,255,0.1);
\`;

const headerStyle = {
  display: 'flex',
  justifyContent: 'space-between',
  alignItems: 'center',
  marginBottom: '12px',
  paddingBottom: '10px',
  borderBottom: '1px solid rgba(255,255,255,0.1)'
};

const titleStyle = { fontWeight: '600', fontSize: '14px' };
const playerStyle = { marginBottom: '10px', padding: '10px', background: 'rgba(255,255,255,0.05)', borderRadius: '8px' };
const nameStyle = { fontWeight: '500', marginBottom: '4px' };
const teamStyle = { fontSize: '11px', color: '#888' };
const statsRow = { display: 'flex', gap: '15px', marginTop: '6px', fontSize: '12px' };
const statValue = { color: '#ff6b35', fontWeight: '600' };
const emptyStyle = { textAlign: 'center', padding: '20px', color: '#666' };

export const render = ({ output }) => {
  try {
    const data = JSON.parse(output);
    if (!data.players || data.players.length === 0) {
      return (
        <div>
          <div style={headerStyle}><span style={titleStyle}>🏆 My Players</span></div>
          <div style={emptyStyle}>No active games</div>
        </div>
      );
    }
    return (
      <div>
        <div style={headerStyle}><span style={titleStyle}>🏆 My Players</span></div>
        {data.players.map((p, i) => (
          <div key={i} style={playerStyle}>
            <div style={nameStyle}>{p.name}</div>
            <div style={teamStyle}>{p.team} | {p.minutes}</div>
            <div style={statsRow}>
              <span><span style={statValue}>{p.points}</span> PTS</span>
              <span><span style={statValue}>{p.rebounds}</span> REB</span>
              <span><span style={statValue}>{p.assists}</span> AST</span>
            </div>
            <div style={{...statsRow, color: '#888'}}>
              <span>{p.threePointers} 3PT</span>
              <span>{p.steals} STL</span>
              <span>{p.blocks} BLK</span>
            </div>
          </div>
        ))}
      </div>
    );
  } catch (e) {
    return (
      <div>
        <div style={headerStyle}><span style={titleStyle}>🏆 My Players</span></div>
        <div style={emptyStyle}>Loading...</div>
      </div>
    );
  }
};`
        };

        function downloadWidget(type) {
            const code = widgetTemplates[type];
            const filename = type === 'scoreboard' ? 'nba-scoreboard.jsx' : 'nba-player-tracker.jsx';

            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showWidgetCode(type) {
            const code = widgetTemplates[type];
            document.getElementById('widgetCodeContent').textContent = code;
            document.getElementById('widgetCodeModal').style.display = 'block';
        }

        function closeWidgetModal() {
            document.getElementById('widgetCodeModal').style.display = 'none';
        }

        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeWidgetModal();
        });

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/static/sw.js');
        }

        // Initial load
        loadScoreboard();
    </script>
</body>
</html>
